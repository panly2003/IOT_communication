# 实验报告

潘乐怡 2020012374 软件02

## 实验背景

1. 实验目的及内容：

   实验目的：实现声波信号通信，掌握物联网设备通信互联的基本原理与方法

   实验内容：基于蓝牙通信的基本原理，实现100长度英文字符数量级的信号传输，并在不同距离、有无噪声、有无遮挡的环境下进行传输实验，并依据结果进行原因分析。

2. 环境配置：见`readme.md`

3. 实现语言：python

## 实现逻辑

1. 英文文本转二进制编码：根据Unicode编码规则转为8位二进制码

2. 二进制编码加蓝牙包

   蓝牙包结构：

   - 前导码preamble_code，10位，[3]*10
   - payload长度，8位
   - 数据内容段payload，最长设置为192位，用于分包

   注：包和包之间，以及开头结尾均有空白段，blank = [2]*30

3. fsk调制

   为0，1，2，3分别设置不同的pulse，每个pulse的持续时间为0.05s：

   - 0: frequency=1000
   - 1: frequency=6000
   - 2: 空
   - 3: frequency=12000

   注1：给3设置为很高的频率，是因为前导码对准在解码时至关重要，前导码对错会导致整个包解码错误，因此希望设置一个比较有区分度的频率

   注2：实验表明pulse持续时间为0.05s较为合适，太短比特错误率较高，而太长则传输时间较长

4. fsk解调

   - step 1：先应用傅里叶变换将整个音频解调出由0、1、2、3组成的序列
   - step 2：前导码对齐
     - 对齐大致位置：用长度为10的滑动窗口，依次和前导码计算对应位符合的个数。当符合比例大于0.7时，就怀疑碰到了前导码
     - 对齐准确位置：从大致位置开始向后的len(preamble_code)长度内，如果有更高的符合比例，则将准确位置定为符合比例最高的位置；再向后找len(preamble_code)长度内是否有3，有就继续后移。（这样做是因为3的frequency显著高于其它，所以如果发现序列中存在3，极大概率是前导码，而不是传错了）

   - step 3：解码数据内容段
     - 解码数据内容段长度：根据前导码准确位置推导数据内容段长度的位置，并解码出长度
     - 根据解码出的长度，将数据内容段读出

5. 将解码出的数据内容段转为字符

   - 按照Unicode编码转换
   - 添加鲁棒性机制：因为Unicode编码中大小写字母的范围只包含[65,91)和[97,123)，因此很有可能出现错误时解码出的字符不是大小写字母。这个时候就可以使用最大匹配，在大小写字母中挑选和该字符比特符合率最大的作为解码结果。

## 测试结果及分析

### 距离对传输性能的影响

| 发送端与接收端距离 | 比特错误率 |
| ------------------ | ---------- |
| 50cm               | 0.0%       |
| 100cm              | 0.0%       |
| 150cm              | 2.4%       |
| 200cm              | 10.7%      |

可以看到，当距离在100cm以内时，传输的比特错误率为0。而当距离增大时比特错误率开始上升。实验分析发现，距离增大时前导码精准对齐仍然没有问题，但是0、1解码错误率上升，优化方法可能包括增大duration，以及添加纠错码机制等。

### 抗干扰能力

设置传输距离为100cm

| 噪声环境           | 比特错误率 |
| ------------------ | ---------- |
| 安静环境           | 0.0%       |
| 人声说话           | 12.5%      |
| 大音量音乐嘈杂环境 | 40.6%      |

可以看到，噪音对信息传输正确率的影响还是很大的，人声、音乐的频率通常在200Hz以下，因此解码时解出空的概率较大，比特错误率较高。

### 遮挡影响

设置传输距离为100cm

| 不同遮挡 | 比特错误率 |
| -------- | ---------- |
| 水杯     | 2.8%       |
| 书籍     | 11.2%      |
| 人体     | 23.1%      |

可以看到，遮挡对比特错误率的影响还是很大的。且更大面积的遮挡对效果的影响更为显著。究其原因是遮挡时声波只能绕道传播，实际传输距离将远大于100cm。